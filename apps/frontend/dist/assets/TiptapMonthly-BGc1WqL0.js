import{r as c,j as e}from"./index-DgBv5UP-.js";import{u as k,E as u,B as x}from"./index-CU6hF58n.js";import{S as j,L as b}from"./index-hgCRUPzZ.js";const S=({tiptap_id:l,pageId:h,className:y,date:o,isCurrentMonth:g,plannerId:p})=>{const[r,d]=c.useState("<p></p>"),[v,m]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const n=await fetch(`/api/planners/${p}/pages/${h}/planner_entries?tiptap_id=${l}`);if(n.ok){const i=await n.json();Array.isArray(i)&&i.length>0?d(i[0].content||"<p></p>"):i.content&&d(i.content||"<p></p>")}else console.error("Failed to fetch planner entry:",n.status)}catch(n){console.error("Error fetching planner entry:",n)}})()},[h,l,p]);const s=k({editable:!0,content:r,onUpdate:({editor:t})=>{const n=t.getHTML();W(h,n,l)},extensions:[j,b.configure({autolink:!0,defaultProtocol:"https",shouldAutoLink:t=>t.startsWith("www.")||t.startsWith("http://")||t.startsWith("https://")||t.endsWith(".com")||t.endsWith(".net")||t.endsWith(".org")||t.endsWith(".io")||t.endsWith(".dev")||t.endsWith(".app")||t.endsWith(".gov")||t.endsWith(".edu")||t.startsWith("slack:")||t.startsWith("git:")||t.startsWith("sms:")||t.startsWith("smsto:")||t.startsWith("mmsto:")||t.startsWith("skype:")||t.startsWith("callto:")||t.startsWith("webcal:")||t.startsWith("tel:")||t.startsWith("mailto:"),openOnClick:!0,protocols:["http","https","mailto","tel","slack","git","fax","modem","sms","smsto","mmsto","skype","callto","webcal"]})]});c.useEffect(()=>{s&&r&&s.commands.setContent(r)},[s,r]);const W=async(t,n,i)=>{if(!t){console.error("Cannot save - pageId is missing");return}if(!v){m(!0);try{const a=await fetch(`/api/planners/${p}/pages/${t}/planner_entries`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n,tiptap_id:i,entry_date:o.toISOString().split("T")[0]})});if(!a.ok){const f=await a.json();throw console.error("Error saving planner entry:",f),new Error(f.error||"Failed to save planner entry")}return await a.json()}catch(a){console.error("Error saving planner entry:",a)}finally{m(!1)}}};return e.jsxs("div",{className:y,style:{opacity:g?1:.5},children:[e.jsxs("div",{className:"content-wrapper",children:[e.jsx("div",{className:"monthly-day-cell-date-box",children:e.jsx("div",{className:"monthly-day-cell-date",children:o==null?void 0:o.getDate()})}),e.jsx(u,{editor:s,className:"monthly-day-cell-tiptap-main",spellCheck:!1})]}),s&&e.jsx(x,{editor:s,children:e.jsxs("div",{className:"bubble-menu",children:[e.jsx("button",{onClick:()=>s.chain().focus().toggleBold().run(),className:s.isActive("bold")?"is-active":"",children:"B"}),e.jsx("button",{onClick:()=>s.chain().focus().toggleItalic().run(),className:s.isActive("italic")?"is-active":"",children:"I"}),e.jsx("button",{onClick:()=>s.chain().focus().toggleStrike().run(),className:s.isActive("strike")?"is-active":"",children:"S"}),e.jsx("button",{onClick:()=>s.chain().focus().toggleLink({href:""}).run(),className:s.isActive("link")?"is-active":"",children:"ðŸ”—"})]})})]})};export{S as T};
